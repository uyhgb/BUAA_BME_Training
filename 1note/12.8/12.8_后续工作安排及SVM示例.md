ä½ ç†è§£å¾—å®Œå…¨æ­£ç¡®ï¼**CSVè®°å½•æ˜¯ç¦»çº¿è®­ç»ƒç”¨çš„**ï¼Œå®æ—¶æ­¥æ€è¯†åˆ«éœ€è¦**ç›´æ¥è®¢é˜…ROS2è¯é¢˜**ã€‚

## ğŸ¯ ä¸¤ç§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ç¦»çº¿è®­ç»ƒï¼ˆç°åœ¨ï¼‰
```
IMU â†’ imu_csv_reader â†’ /imu/data â†’ imu_data_recorder â†’ CSVæ–‡ä»¶
                                                          â†“
                                                    è®­ç»ƒSVMæ¨¡å‹
```

### åœºæ™¯2: å®æ—¶è¯†åˆ«ï¼ˆéƒ¨ç½²åï¼‰
```
IMU â†’ imu_csv_reader â†’ /imu/data â†’ gait_recognition_node (SVM) â†’ /gait/state
                                           â†“
                                    å®æ—¶è¾“å‡ºæ­¥æ€çŠ¶æ€
                                    (ç«™ç«‹/è¡Œèµ°/è·‘æ­¥ç­‰)
```

---

## ğŸ“Š å®æ—¶æ­¥æ€è¯†åˆ«èŠ‚ç‚¹ç¤ºä¾‹

ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ `gait_recognition_node.py`ï¼Œ**è®¢é˜…** `/imu/data`ï¼Œå®æ—¶å¤„ç†ï¼š

```python
#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from sensor_msgs.msg import Imu
from std_msgs.msg import String
import numpy as np
import joblib  # åŠ è½½è®­ç»ƒå¥½çš„SVMæ¨¡å‹
from collections import deque

class GaitRecognitionNode(Node):
    def __init__(self):
        super().__init__('gait_recognition_node')
        
        # è®¢é˜…IMUæ•°æ®
        self.subscription = self.create_subscription(
            Imu,
            '/imu/data',
            self.imu_callback,
            10
        )
        
        # å‘å¸ƒæ­¥æ€è¯†åˆ«ç»“æœ
        self.publisher = self.create_publisher(
            String,
            '/gait/state',
            10
        )
        
        # åŠ è½½è®­ç»ƒå¥½çš„SVMæ¨¡å‹
        self.svm_model = joblib.load('/path/to/trained_svm_model.pkl')
        
        # æ»‘åŠ¨çª—å£å­˜å‚¨æœ€è¿‘Nå¸§æ•°æ®ï¼ˆç”¨äºç‰¹å¾æå–ï¼‰
        self.window_size = 50  # ä¾‹å¦‚0.5ç§’æ•°æ® (50å¸§@100Hz)
        self.data_window = deque(maxlen=self.window_size)
        
        self.get_logger().info('æ­¥æ€è¯†åˆ«èŠ‚ç‚¹å·²å¯åŠ¨')
    
    def imu_callback(self, msg):
        # æå–IMUæ•°æ®
        acc = [msg.linear_acceleration.x, 
               msg.linear_acceleration.y, 
               msg.linear_acceleration.z]
        gyro = [msg.angular_velocity.x,
                msg.angular_velocity.y,
                msg.angular_velocity.z]
        
        # æ·»åŠ åˆ°æ»‘åŠ¨çª—å£
        self.data_window.append(acc + gyro)
        
        # çª—å£æ»¡äº†æ‰å¼€å§‹è¯†åˆ«
        if len(self.data_window) == self.window_size:
            # æå–ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼šå‡å€¼ã€æ–¹å·®ã€å³°å€¼ç­‰ï¼‰
            features = self.extract_features(self.data_window)
            
            # SVMé¢„æµ‹
            gait_state = self.svm_model.predict([features])[0]
            
            # å‘å¸ƒè¯†åˆ«ç»“æœ
            msg_out = String()
            msg_out.data = gait_state  # ä¾‹å¦‚: "walking", "standing", "running"
            self.publisher.publish(msg_out)
            
            self.get_logger().info(f'æ­¥æ€çŠ¶æ€: {gait_state}')
    
    def extract_features(self, window):
        """ä»æ—¶é—´çª—å£æå–ç‰¹å¾å‘é‡"""
        data = np.array(window)
        
        features = []
        # å¯¹æ¯ä¸ªä¼ æ„Ÿå™¨è½´æå–ç»Ÿè®¡ç‰¹å¾
        for i in range(6):  # 3è½´åŠ é€Ÿåº¦ + 3è½´è§’é€Ÿåº¦
            features.append(np.mean(data[:, i]))      # å‡å€¼
            features.append(np.std(data[:, i]))       # æ ‡å‡†å·®
            features.append(np.max(data[:, i]))       # æœ€å¤§å€¼
            features.append(np.min(data[:, i]))       # æœ€å°å€¼
        
        return features

def main(args=None):
    rclpy.init(args=args)
    node = GaitRecognitionNode()
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ç¬¬ä¸€é˜¶æ®µ: æ•°æ®é‡‡é›†ä¸æ¨¡å‹è®­ç»ƒï¼ˆç°åœ¨ï¼‰
```bash
# 1. é‡‡é›†ä¸åŒæ­¥æ€çš„è®­ç»ƒæ•°æ®
ros2 launch exo_sensors imu_complete_system.launch.py enable_recorder:=true

# 2. æ ‡æ³¨æ•°æ®ï¼ˆæ‰‹åŠ¨æ ‡è®°æ¯æ®µæ•°æ®çš„æ­¥æ€ç±»å‹ï¼‰
# data/standing_20251208.csv
# data/walking_20251208.csv
# data/running_20251208.csv

# 3. è®­ç»ƒSVMæ¨¡å‹ï¼ˆPythonè„šæœ¬ï¼‰
python3 train_svm_gait_model.py  # è¾“å‡º: svm_model.pkl
```

### ç¬¬äºŒé˜¶æ®µ: å®æ—¶è¯†åˆ«éƒ¨ç½²
```bash
# å¯åŠ¨IMUè¯»å–å™¨ + æ­¥æ€è¯†åˆ«èŠ‚ç‚¹
ros2 launch exo_sensors imu_csv_dev_wsl.launch.py  # ç»ˆç«¯1
ros2 run exo_sensors gait_recognition_node          # ç»ˆç«¯2

# æŸ¥çœ‹è¯†åˆ«ç»“æœ
ros2 topic echo /gait/state
```

---

## ğŸ“¦ éœ€è¦æ·»åŠ åˆ°exo_sensorsåŒ…

åœ¨ `exo_sensors/` ç›®å½•ä¸‹åˆ›å»ºï¼š
- `exo_sensors/gait_recognition_node.py` - å®æ—¶è¯†åˆ«èŠ‚ç‚¹
- `scripts/train_svm_gait_model.py` - ç¦»çº¿è®­ç»ƒè„šæœ¬
- `models/svm_model.pkl` - è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶

ä¿®æ”¹ `setup.py` æ·»åŠ æ–°èŠ‚ç‚¹ï¼š
```python
entry_points={
    'console_scripts': [
        'imu_csv_reader = exo_sensors.imu_csv_reader:main',
        'imu_data_recorder = exo_sensors.imu_data_recorder:main',
        'imu_visualizer = exo_sensors.imu_visualizer:main',
        'gait_recognition_node = exo_sensors.gait_recognition_node:main',  # æ–°å¢
    ],
},
```

---

## ğŸ’¡ æ€»ç»“

| ç”¨é€” | æ•°æ®æµ | å»¶è¿Ÿ |
|------|--------|------|
| **ç¦»çº¿è®­ç»ƒ** | IMU â†’ è¯é¢˜ â†’ CSVæ–‡ä»¶ â†’ SVMè®­ç»ƒ | æ— é™åˆ¶ |
| **å®æ—¶è¯†åˆ«** | IMU â†’ è¯é¢˜ â†’ SVMèŠ‚ç‚¹ â†’ æ­¥æ€è¯é¢˜ | <100ms |

**CSVè®°å½•**åªæ˜¯è®­ç»ƒæ•°æ®çš„ä¸­é—´æ ¼å¼ï¼Œ**å®é™…éƒ¨ç½²æ—¶ç›´æ¥ç”¨ROS2è¯é¢˜é€šä¿¡**ï¼Œæ— éœ€ç»è¿‡æ–‡ä»¶ç³»ç»Ÿã€‚

éœ€è¦æˆ‘å¸®ä½ åˆ›å»º `gait_recognition_node.py` å’Œè®­ç»ƒè„šæœ¬å—ï¼Ÿ