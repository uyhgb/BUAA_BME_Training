# 测试IMU数据接收
cd /workspace/robot_ws && source /opt/ros/humble/setup.bash && source install/setup.bash && timeout 10 ros2 launch exo_sensors imu_csv_dev_wsl.launch.py 2>&1 | head -50

# 验证发布的话题
cd /workspace/robot_ws && source /opt/ros/humble/setup.bash && source install/setup.bash && timeout 15 bash -c "ros2 launch exo_sensors imu_csv_dev_wsl.launch.py &>/dev/null & sleep 3 && ros2 topic echo /imu/data --once && ros2 topic hz /imu/data --window 30"

# 输出的单位
让我详细解释这些单位和条件编译的含义: 

读取 [](file:///d%3A/1CodeProject/BUAA_BME_Training/sensor_source_code/9DOF_Demo_v3/QMI8658.cpp#1-1)，行 1 到 110

## 📊 单位含义和条件编译解释:

### 1️⃣ **加速度计单位切换**:

```cpp
#if defined(QMI8658_UINT_MG_DPS)
    // mg (毫重力加速度)
    acc[0] = (float)(raw_acc_xyz[0]*1000.0f)/g_imu.ssvt_a
#else
    // m/s² (米每二次方秒)
    acc[0] = (float)(raw_acc_xyz[0]*ONE_G)/g_imu.ssvt_a  // ONE_G = 9.807
#endif
```

**单位对比**:
- **`mg`** (毫重力): 1g = 1000mg，物理意义是地球重力加速度的千分之一
  - 例: 静止时 Z 轴约 1000mg (1g)
- **`m/s²`** (国际单位): 1g ≈ 9.807 m/s²
  - 例: 静止时 Z 轴约 9.807 m/s²

---

### 2️⃣ **陀螺仪单位切换**:

```cpp
#if defined(QMI8658_UINT_MG_DPS)
    // dps (度每秒)
    gyro[0] = (float)(raw_gyro_xyz[0]*1.0f)/g_imu.ssvt_g
#else
    // rad/s (弧度每秒)
    gyro[0] = (float)(raw_gyro_xyz[0]*M_PI)/(g_imu.ssvt_g*180)  // 转换为弧度
#endif
```

**单位对比**:
- **`dps`** (度每秒): 直观的角速度单位，360°/s = 转一圈每秒
  - 例: 快速转动可能达到 200-300 dps
- **`rad/s`** (弧度每秒): 国际单位，1 rad/s ≈ 57.3 dps
  - 例: 快速转动约 3.5-5.2 rad/s

---

### 3️⃣ **为什么用 `#if-else` 条件编译?**

这是 **编译期选择**,不是运行时判断:

```cpp
#define QMI8658_UINT_MG_DPS  // ← 第5行定义了这个宏
```

**原因**:
1. **避免运行时开销**: 编译时决定用哪套公式,运行时不需要 if 判断
2. **灵活切换单位**: 注释掉这一行就自动切换到国际单位制
3. **兼容不同应用**: 游戏控制用 dps 直观,机器人控制用 rad/s 标准

---

## 🎯 **你当前代码的实际单位**:

因为第 5 行定义了 `#define QMI8658_UINT_MG_DPS`,所以你的数据单位是:

| 数据字段 | 变量名 | 实际单位 | 物理含义 | 典型值范围 |
|---------|--------|---------|---------|-----------|
| **Roll/Pitch/Yaw** | `stAngles` | **度 (°)** | 欧拉角 | -180° ~ +180° |
| **AccX/Y/Z** | `stAccelRawData` | **mg** | 加速度(毫重力) | 静止约±1000mg |
| **GyroX/Y/Z** | `stGyroRawData` | **dps** | 角速度(度每秒) | 静止约±5dps |

---

## 📝 CSV 输出示例:

```csv
Timestamp,Roll,Pitch,Yaw,AccX,AccY,AccZ,GyroX,GyroY,GyroZ
1000,2.34°,-1.23°,89.45°,50mg,-30mg,1000mg,0.12dps,-0.45dps,0.23dps
```

**注意**: 你的 `snprintf` 格式化中:
- 加速度用 `%.3f` (3位小数) - 因为 mg 量级较大
- 陀螺仪用 `%.2f` (2位小数) - 因为 dps 通常个位数

---

## 💡 如果要切换到国际单位:

注释掉 QMI8658.cpp 第 5 行:
```cpp
// #define QMI8658_UINT_MG_DPS  // 注释掉
```

重新编译后,单位会变成:
- 加速度: **m/s²** (约 0.05 ~ 9.8)
- 陀螺仪: **rad/s** (约 0.002 ~ 5.2)

**但对于 SVM 步态识别,用 mg/dps 更合适!** 因为:
1. 数值范围更直观
2. 避免浮点精度损失(不需要乘 9.807 或 π)
3. 大多数 IMU 数据集也用这个单位