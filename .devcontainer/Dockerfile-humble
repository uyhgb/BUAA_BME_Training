FROM althack/ros2:humble-full

ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone 
USER root

# install git
RUN apt update && apt install -y git

WORKDIR /workspace
RUN echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc 
RUN apt update && apt install -y ros-humble-rmw-cyclonedds-cpp ros-humble-rosidl-generator-dds-idl

# 配置 pip 清华镜像源（加速 Python 包下载）
RUN pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 安装 Python 依赖
# exo_sensors 功能包: pyserial, numpy, matplotlib
# exoskel_control_py 功能包: scipy, scikit-learn, joblib
# 注意: NumPy 固定为 1.24.3 以兼容 SciPy (NumPy 2.x 会导致 scipy 崩溃)
# 推荐写法：把 numpy 单独拎出来，或者显式锁死版本
RUN pip3 install --no-cache-dir \
    pyserial \
    "numpy==1.24.4" \
    matplotlib \
    scipy \
    scikit-learn \
    joblib

# 配置代理环境变量（使用 host.docker.internal 访问宿主机）
ENV http_proxy=http://host.docker.internal:54009
ENV https_proxy=http://host.docker.internal:54009
ENV no_proxy=localhost,127.0.0.1

CMD [ "/bin/bash" ]